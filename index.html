<!doctype html>
<html lang="ja" >
	<head>
		<meta charset="utf-8">
		<title>React Calendar</title>
		<link rel="stylesheet" href="css/main.css" type="text/css" />
		
		<meta name="google-signin-scope" content="profile email">
		<meta name="google-signin-scope" content="https://www.googleapis.com/auth/calendar">
		<meta name="google-signin-client_id" content="706058134878-ftt291asscckifh6qpp1b6n2rk8h03nk.apps.googleusercontent.com">
    	<script src="https://apis.google.com/js/platform.js" async defer></script>		
		<script src="https://apis.google.com/js/client.js" async defer></script>
    	
		<!-- For Material UI -->
		<link href='https://fonts.googleapis.com/css?family=Roboto:400,300,500&subset=latin,greek' rel='stylesheet' type='text/css'>	
	</head>
	<body>
		<header>
			<div class="g-signin2" data-onsuccess="onSignInSuccess" data-onfailure='onSignInError'></div>
			
			<div>
				<a class="btn-signout" href="#" onclick="signOut();">Sign out</a>
				<script>
 					//var CLIENT_ID = '706058134878-ftt291asscckifh6qpp1b6n2rk8h03nk.apps.googleusercontent.com';
      				//var SCOPES = ["profile email", "https://www.googleapis.com/auth/calendar"];
      				//var myApiKey = 'AIzaSyBOEo7IT75m_o_7WmdTblMrDEJjRBmeZRM';

					// function checkAuth() {
				 //       gapi.auth.authorize({
				 //           'client_id': CLIENT_ID,
				 //           'scope': SCOPES.join(' '),
				 //           'immediate': true
				 //         }, handleAuthResult);
				 //   }
				    
				 //   function handleAuthResult(authResult) {
				 //       //var authorizeDiv = document.getElementById('authorize-div');
				 //       if (authResult && !authResult.error) {
				 //         // Hide auth UI, then load client library.
				 //         //authorizeDiv.style.display = 'none';
				 //         console.log('authResult=', authResult);
				 //         //loadCalendarApi();
				 //       } else {
				 //         // Show auth UI, allowing the user to initiate authorization by
				 //         // clicking authorize button.
				 //         //authorizeDiv.style.display = 'inline';
				 //       }
				 //   }
				    
				    function loadCalendarApi(calendar_id) {
				        gapi.client.load('calendar', 'v3', function(){
				        	getEvents(calendar_id);
				        });
				    }				    
				    
				    function onSignInError(err){
				    	console.log('Google signin error.', err);
				    }
							
					function onSignInSuccess(googleUser) {
					  var profile = googleUser.getBasicProfile();
					  console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
					  console.log('Name: ' + profile.getName());
					  console.log('Image URL: ' + profile.getImageUrl());
					  var email = profile.getEmail();
					  console.log('Email: ' + email);
					  
					  //var id_token = googleUser.getAuthResponse().id_token;
					  //console.log('ID Token: ' + id_token);
			          loadCalendarApi(email);
					}

	  				function signOut() {
	    				var auth2 = gapi.auth2.getAuthInstance();
	    				auth2.signOut().then(function () {
	      				console.log('User signed out.');
	    				});
	  				}
	  				
	  				function getEvents(calendar_id){
				        var request = gapi.client.calendar.events.list({
				          'calendarId': calendar_id, //'primary',
				          'timeMin': (new Date()).toISOString(),
				          'showDeleted': false,
				          'singleEvents': true,
				          'maxResults': 10,
				          'orderBy': 'startTime'
				        });
				        
				        request.execute(function(resp) {
				          var events = resp.items;
				          appendPre('Upcoming events:');
				
				          if (events.length > 0) {
				            for (i = 0; i < events.length; i++) {
				              var event = events[i];
				              var when = event.start.dateTime;
				              if (!when) {
				                when = event.start.date;
				              }
				              appendPre(event.summary + ' (' + when + ')')
				            }
				          } else {
				            appendPre('No upcoming events found.');
				          }
				
				        });

	  				}
	  				
					function appendPre(message) {
						var pre = document.getElementById('output');
						var textContent = document.createTextNode(message + '\n');
						pre.appendChild(textContent);
					}	  				
				</script>
    			<!--<script src="https://apis.google.com/js/client.js?onload=checkAuth"></script>-->
		</header>
		
		<pre id="output"></pre>
		
		<section class="calenderapp"></section>
		
		<footer> 
			<p>
				Calendar example using React and Flux | 
				<a href="https://github.com/mikehibm/react-calendar" target="_blank">https://github.com/mikehibm/react-calendar</a>
			</p>
		</footer>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.11.2/moment.min.js"></script>
		<script src="build/bundle.js"></script>
	</body>
</html>